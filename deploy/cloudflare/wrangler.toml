# KeyPick Cloudflare Workers Configuration

name = "keypick-gateway"
main = "worker.js"
compatibility_date = "2024-01-01"

# Development environment
[env.development]
vars = { BACKEND_URL = "http://localhost:8000" }

# Production environment
[env.production]
vars = { BACKEND_URL = "https://keypick.fly.dev" }

# KV Namespace for caching (must be in each environment)
# Replace with your actual KV namespace IDs after creating them
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "YOUR_KV_NAMESPACE_ID"  # Replace with actual ID from: wrangler kv namespace create "CACHE"

[[env.development.kv_namespaces]]
binding = "CACHE"
preview_id = "YOUR_KV_PREVIEW_ID"  # Replace with actual preview_id from: wrangler kv namespace create "CACHE" --preview

# Queue for async tasks (requires Workers Paid plan - $5/month)
# Uncomment below if you have Workers Paid plan
# [[queues.producers]]
# binding = "CRAWLER_QUEUE"
# queue = "keypick-crawler-queue"
#
# [[queues.consumers]]
# queue = "keypick-crawler-queue"
# max_batch_size = 10
# max_batch_timeout = 30

# Secrets (set via wrangler secret put)
# KEYPICK_API_KEYS - Comma-separated list of valid API keys
# INTERNAL_KEY - Secret key for backend communication

# Routes (optional, can be configured in dashboard)
# route = { pattern = "keypick.example.com/*", zone_name = "example.com" }

# Usage model
usage_model = "bundled"  # or "unbound" for longer execution (requires paid plan)

# Limits (requires Workers Paid plan - comment out for free plan)
# [limits]
# cpu_ms = 50  # Only available on paid plan

# Observability
[observability]
enabled = true

# Triggers (optional)
# [triggers]
# crons = ["*/5 * * * *"]  # Run every 5 minutes